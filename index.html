<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>DClin Vault</title>
<meta name="apple-mobile-web-app-title" content="DClin Vault">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="apple-touch-icon" href="icon.png">

<style>
  :root { 
    --bg: #000; 
    --glass: rgba(28, 28, 28, 0.85); 
    --glass-bright: rgba(45, 45, 45, 0.95);
    --border: rgba(255, 255, 255, 0.18);
    /* Neon Palette */
    --glow-üìí: #ffd700; --glow-üß†: #ff69b4; --glow-üí≠: #ffffff; 
    --glow-‚ôªÔ∏è: #00ff00; --glow-üéí: #ff4500; --glow-ü§ñ: #00ffff;
  }
  
  body { 
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; 
    background: var(--bg); color: #fff; 
    margin: 0; padding: 0; height: 100dvh; overflow: hidden; overscroll-behavior: none;
    display: flex; justify-content: center;
    -webkit-font-smoothing: antialiased;
  }

  /* Safe Zone Wrapper for iPhone margins */
  .app-container { 
    height: 100%; width: 100%; max-width: 440px; 
    display: flex; flex-direction: column;
    padding: calc(env(safe-area-inset-top) + 10px) 0 env(safe-area-inset-bottom) 0; 
    box-sizing: border-box;
  }

  .nav-bar { display: flex; justify-content: space-between; margin: 0 45px 15px 45px; border-bottom: 1px solid var(--border); padding-bottom: 12px; }
  .nav-btn { background: none; border: none; color: #666; font-size: 8.5px; font-weight: 900; letter-spacing: 1.2px; text-transform: uppercase; transition: 0.3s; }
  .nav-active { color: #fff; text-shadow: 0 0 10px #fff; }

  .view { display: none; flex-direction: column; flex: 1; overflow: hidden; padding: 0 45px; box-sizing: border-box; }
  .active-view { display: flex; }

  /* Input Area - Hidden Scrollbar */
  .input-area { position: relative; flex: 1; display: flex; flex-direction: column; gap: 10px; }
  textarea { 
    flex: 1; background: var(--glass); border: 1px solid var(--border); 
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border-radius: 20px; padding: 22px; color: #fff; font-size: 17px; 
    outline: none; resize: none; width: 100%; box-sizing: border-box; line-height: 1.5;
    scrollbar-width: none; -ms-overflow-style: none;
  }
  textarea::-webkit-scrollbar { display: none; }

  .add-img-ico { position: absolute; bottom: 85px; right: 15px; width: 40px; height: 40px; background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 1px solid var(--border); z-index: 10; }

  /* Emoji Selection - Stationary */
  .emoji-row { display: flex; justify-content: space-between; margin: 15px 0; width: 100%; }
  .emoji-btn { 
    font-size: 22px; width: 44px; height: 44px; border-radius: 50%; 
    border: 2px solid transparent; 
    background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; 
    transition: 0.3s; filter: grayscale(0.5); opacity: 0.7; cursor: pointer;
  }
  .emoji-btn.active { filter: grayscale(0); opacity: 1; box-shadow: 0 0 20px currentColor; border-color: currentColor; background: rgba(255,255,255,0.2); }

  /* Calendar - Fixed Height & Stationary */
  .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; width: 100%; margin-bottom: 15px; min-height: 320px; }
  .cal-day { font-size: 11px; height: 48px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255,255,255,0.06); border-radius: 10px; position: relative; border: 2px solid transparent; transition: border-color 0.2s; }
  .cal-day-active { border-color: #fff; background: rgba(255,255,255,0.15); font-weight: bold; }
  .dot-row { display: flex; gap: 4px; position: absolute; bottom: 6px; }
  .dot { width: 5px; height: 5px; border-radius: 50%; }
  .dot-created { background: #00bfff; box-shadow: 0 0 8px #00bfff; } 
  .dot-due { background: #ff4500; box-shadow: 0 0 8px #ff4500; }

  /* Scrolling */
  .scroll { 
    overflow-y: auto; flex: 1; padding: 10px 5px; width: 100%; box-sizing: border-box; 
    scrollbar-width: none; -ms-overflow-style: none;
  }
  .scroll::-webkit-scrollbar { display: none; }

  /* Card Preview Logic */
  .card { 
    background: rgba(255,255,255,0.05); border: 1px solid var(--border); 
    padding: 20px; border-radius: 20px; margin-bottom: 12px; 
    position: relative; width: 100%; box-sizing: border-box; transition: 0.3s; 
    cursor: pointer;
  }
  .card-ico { 
    position: absolute; right: 15px; top: 15px; font-size: 13px; width: 30px; height: 30px; 
    display: flex; align-items: center; justify-content: center; border-radius: 50%; 
    border: 1px solid currentColor; box-shadow: 0 0 10px currentColor; background: #000;
  }
  
  .card-txt { 
    font-size: 16px; line-height: 1.5; margin-top: 8px; width: 85%; color: #eee; 
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .card.expanded .card-txt { -webkit-line-clamp: unset; }

  .card-imgs { display: none; gap: 10px; overflow-x: auto; margin-top: 15px; }
  .card.expanded .card-imgs { display: flex; }
  .card-thumb { width: 70px; height: 70px; border-radius: 10px; object-fit: cover; border: 1px solid var(--border); flex-shrink: 0; }
  
  .card-actions { margin-top: 18px; padding-top: 14px; border-top: 1px solid rgba(255,255,255,0.05); display: flex; gap: 15px; font-size: 9px; font-weight: bold; }

  .export-bar { background: #0a0a0a; color: #fff; border: 1px solid var(--border); padding: 14px; border-radius: 12px; font-size: 10px; font-weight: 800; margin-bottom: 10px; width: 100%; box-sizing: border-box; text-align: left; }
  .main-btn { background: #fff; color: #000; padding: 20px; border-radius: 18px; font-weight: 900; letter-spacing: 3px; border: none; margin-bottom: 10px; width: 100%; transition: 0.2s; }
  .main-btn:active { transform: scale(0.98); }

  #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 5000; justify-content: center; align-items: center; backdrop-filter: blur(10px); }
</style>
</head>
<body>

<div id="modal" onclick="this.style.display='none'"><img id="mImg" style="max-width:90%; max-height:80%; border-radius:10px;"></div>

<div class="app-container">
  <div class="nav-bar">
    <button id="nav-capture" class="nav-btn nav-active" onclick="setView('capture', this)">Capture</button>
    <button id="nav-lists" class="nav-btn" onclick="setView('lists', this)">Lists</button>
    <button id="nav-calendar" class="nav-btn" onclick="setView('calendar', this)">Calendar</button>
    <button id="nav-completed" class="nav-btn" onclick="setView('completed', this)">Completed</button>
  </div>

  <div id="capture" class="view active-view">
    <div class="input-area">
      <div id="pStrip" class="card-thumb-row" style="display:none; height:70px; gap:10px; margin-bottom:10px;"></div>
      <textarea id="noteIn" placeholder="Select category below..."></textarea>
      <div class="add-img-ico" onclick="document.getElementById('fIn').click()">+</div>
      <input type="file" id="fIn" hidden multiple accept="image/*" onchange="handleImgs(this)">
      <div style="background:var(--glass); padding:15px; border-radius:15px; border:1px solid var(--border)">
        <div style="font-size:8px; color:#aaa; margin-bottom:5px; letter-spacing: 1px;">DEADLINE</div>
        <input type="date" id="dueIn" style="background:none; border:none; color:#fff; width:100%; color-scheme:dark">
      </div>
    </div>
    <div class="emoji-row" id="capEmojiBar">
      <div class="emoji-btn" onclick="selE('üìí', this)">üìí</div>
      <div class="emoji-btn" onclick="selE('üß†', this)">üß†</div>
      <div class="emoji-btn" onclick="selE('üí≠', this)">üí≠</div>
      <div class="emoji-btn" onclick="selE('‚ôªÔ∏è', this)">‚ôªÔ∏è</div>
      <div class="emoji-btn" onclick="selE('üéí', this)">üéí</div>
      <div class="emoji-btn" onclick="selE('ü§ñ', this)">ü§ñ</div>
    </div>
    <button class="main-btn" id="saveBtn" onclick="save()">Save note</button>
  </div>

  <div id="lists" class="view">
    <div class="emoji-row" id="filterListRow">
        <div class="emoji-btn" onclick="setF('üìí', this)">üìí</div><div class="emoji-btn" onclick="setF('üß†', this)">üß†</div>
        <div class="emoji-btn" onclick="setF('üí≠', this)">üí≠</div><div class="emoji-btn" onclick="setF('‚ôªÔ∏è', this)">‚ôªÔ∏è</div>
        <div class="emoji-btn" onclick="setF('üéí', this)">üéí</div><div class="emoji-btn" onclick="setF('ü§ñ', this)">ü§ñ</div>
        <div class="emoji-btn active" onclick="setF('', this)" style="filter:none; opacity:1; font-size:9px; color:#aaa">ALL</div>
    </div>
    <input type="text" id="qL" class="export-bar" placeholder="SEARCH ACTIVE..." oninput="render()">
    <button class="export-bar" onclick="exportData('lists')">Export as text file</button>
    <div id="lSc" class="scroll"></div>
  </div>

  <div id="calendar" class="view">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <button onclick="changeMonth(-1)" class="nav-btn">PREV</button>
        <div id="calLabel" style="font-size:12px; font-weight:900;"></div>
        <button onclick="changeMonth(1)" class="nav-btn">NEXT</button>
    </div>
    <div id="calGrid" class="cal-grid"></div>
    <div id="calDaySc" class="scroll"></div>
  </div>

  <div id="completed" class="view">
    <div class="emoji-row" id="filterDoneRow">
        <div class="emoji-btn" onclick="setF('üìí', this)">üìí</div><div class="emoji-btn" onclick="setF('üß†', this)">üß†</div>
        <div class="emoji-btn" onclick="setF('üí≠', this)">üí≠</div><div class="emoji-btn" onclick="setF('‚ôªÔ∏è', this)">‚ôªÔ∏è</div>
        <div class="emoji-btn" onclick="setF('üéí', this)">üéí</div><div class="emoji-btn" onclick="setF('ü§ñ', this)">ü§ñ</div>
        <div class="emoji-btn active" onclick="setF('', this)" style="filter:none; opacity:1; font-size:9px; color:#aaa">ALL</div>
    </div>
    <input type="text" id="qD" class="export-bar" placeholder="SEARCH COMPLETED..." oninput="render()">
    <button class="export-bar" onclick="exportData('completed')">Export as text file</button>
    <div id="dSc" class="scroll"></div>
  </div>
</div>

<script>
  let vault = JSON.parse(localStorage.getItem('courseVaultPro')) || [];
  let curE = ''; let fE = ''; let imgs = []; let editId = null;
  let calD = new Date(); let selD = new Date().toISOString().split('T')[0];
  
  const names = { 'üìí':'UNIVERSITY', 'üß†':'NEURO', 'üí≠':'CBT', '‚ôªÔ∏è':'SYSTEMIC', 'üéí':'PLACEMENT', 'ü§ñ':'OTHER', '': 'ALL' };
  const prompts = { 
    'üìí':'Write your University note here...', 'üß†':'Write your Neuro note here...', 
    'üí≠':'Write your CBT note here...', '‚ôªÔ∏è':'Write your Systemic note here...', 
    'üéí':'Write your Placement note here...', 'ü§ñ':'Write your General note here...' 
  };

  function setView(id, btn) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
    document.querySelectorAll('.nav-bar .nav-btn').forEach(n => n.classList.remove('nav-active'));
    document.getElementById(id).classList.add('active-view');
    btn.classList.add('nav-active');
    if(id === 'calendar') buildCal();
    render();
  }

  function selE(e, btn) {
    curE = e;
    document.querySelectorAll('#capEmojiBar .emoji-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    btn.style.color = `var(--glow-${e})`;
    const area = document.getElementById('noteIn');
    area.style.borderColor = `var(--glow-${e})`;
    area.placeholder = prompts[e];
  }

  function setF(e, btn) {
    fE = e;
    const currentView = document.querySelector('.view.active-view');
    currentView.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    render();
  }

  function handleImgs(input) {
    Array.from(input.files).forEach(file => {
      const r = new FileReader();
      r.onload = e => { 
        imgs.push(e.target.result); 
        document.getElementById('pStrip').style.display = 'flex';
        document.getElementById('pStrip').innerHTML += `<img src="${e.target.result}" style="width:55px; height:55px; border-radius:8px; object-fit:cover;">`;
      };
      r.readAsDataURL(file);
    });
  }

  function save() {
    const txt = document.getElementById('noteIn').value;
    const due = document.getElementById('dueIn').value;
    if(!txt || !curE) return;
    const en = { id: editId || Date.now(), created: new Date().toISOString().split('T')[0], text: txt, emoji: curE, due, imgs: [...imgs], done: false };
    if(editId) vault = vault.map(i => i.id === editId ? en : i); else vault.push(en);
    localStorage.setItem('courseVaultPro', JSON.stringify(vault));
    clrCap(); setView('lists', document.getElementById('nav-lists'));
  }

  function clrCap() {
    editId = null; imgs = []; curE = '';
    const area = document.getElementById('noteIn');
    area.value = ''; area.placeholder = "Select category below...";
    area.style.borderColor = 'var(--border)';
    document.getElementById('dueIn').value = '';
    document.getElementById('pStrip').innerHTML = ''; document.getElementById('pStrip').style.display = 'none';
    document.querySelectorAll('#capEmojiBar .emoji-btn').forEach(b => { b.classList.remove('active'); b.style.color = ''; });
    document.getElementById('saveBtn').innerText = "Save note";
  }

  function render() {
    const qL = document.getElementById('qL').value.toLowerCase();
    const qD = document.getElementById('qD').value.toLowerCase();
    const lSc = document.getElementById('lSc'); const dSc = document.getElementById('dSc');
    const fv = vault.filter(i => (fE === '' || i.emoji === fE));
    lSc.innerHTML = fv.filter(i => !i.done && i.text.toLowerCase().includes(qL)).reverse().map(i => card(i)).join('');
    dSc.innerHTML = fv.filter(i => i.done && i.text.toLowerCase().includes(qD)).reverse().map(i => card(i)).join('');
  }

  function toggleCard(id) {
    if(event.target.closest('.card-actions')) return;
    document.getElementById(`item-${id}`).classList.toggle('expanded');
  }

  function card(i) {
    let countdown = "";
    if(i.due && !i.done) {
      const diff = Math.ceil((new Date(i.due) - new Date()) / 86400000);
      countdown = diff === 0 ? "Due Today" : diff < 0 ? "Overdue" : `${diff} Days Left`;
    }
    return `
      <div id="item-${i.id}" class="card" onclick="toggleCard(${i.id})" style="border-left: 4px solid var(--glow-${i.emoji})">
        <div class="card-ico" style="color:var(--glow-${i.emoji}); border-color:var(--glow-${i.emoji}); box-shadow: 0 0 10px var(--glow-${i.emoji})">${i.emoji}</div>
        <div class="card-txt">${i.text}</div>
        ${i.imgs.length ? `<div class="card-imgs">${i.imgs.map(m => `<img src="${m}" class="card-thumb" onclick="full('${m}')">`).join('')}</div>` : ''}
        ${countdown ? `<div style="font-size:9px; color:#ff4500; font-weight:800; margin-top:10px">DUE: ${i.due} (${countdown})</div>` : ''}
        <div class="card-actions">
          <span onclick="toggle(${i.id})" style="color:#0f8">${i.done ? 'RESTORE' : 'DONE'}</span>
          <span onclick="edit(${i.id})" style="color:#aaa">EDIT</span>
          <span onclick="del(${i.id})" style="color:#f44">DELETE</span>
        </div>
      </div>`;
  }

  function full(s) { document.getElementById('mImg').src = s; document.getElementById('modal').style.display = 'flex'; event.stopPropagation(); }
  function toggle(id) { vault = vault.map(i => i.id === id ? {...i, done: !i.done} : i); localStorage.setItem('courseVaultPro', JSON.stringify(vault)); render(); }
  function del(id) { if(confirm('Purge?')) { vault = vault.filter(i => i.id !== id); localStorage.setItem('courseVaultPro', JSON.stringify(vault)); render(); buildCal(); } }

  function edit(id) {
    const i = vault.find(x => x.id === id); editId = id;
    const area = document.getElementById('noteIn');
    area.value = i.text; area.placeholder = prompts[i.emoji];
    document.getElementById('dueIn').value = i.due;
    imgs = i.imgs; curE = i.emoji;
    document.getElementById('pStrip').style.display = imgs.length ? 'flex' : 'none';
    document.getElementById('pStrip').innerHTML = imgs.map(m => `<img src="${m}" class="card-thumb">`).join('');
    document.getElementById('saveBtn').innerText = "Update note";
    setView('capture', document.getElementById('nav-capture'));
    document.querySelectorAll('#capEmojiBar .emoji-btn').forEach(b => {
      if(b.innerText === i.emoji) { b.classList.add('active'); b.style.color = `var(--glow-${i.emoji})`; area.style.borderColor = `var(--glow-${i.emoji})`; }
    });
  }

  function buildCal() {
    const grid = document.getElementById('calGrid'); const label = document.getElementById('calLabel');
    grid.innerHTML = ''; const y = calD.getFullYear(); const m = calD.getMonth();
    label.innerText = new Intl.DateTimeFormat('en-US', {month:'long', year:'numeric'}).format(calD).toUpperCase();
    const first = new Date(y, m, 1).getDay(); const days = new Date(y, m+1, 0).getDate();
    for(let i=0; i<first; i++) grid.innerHTML += `<div></div>`;
    for(let d=1; d<=days; d++) {
      const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const hasC = vault.some(i => i.created === dStr); const hasD = vault.some(i => i.due === dStr);
      grid.innerHTML += `<div class="cal-day ${selD===dStr?'cal-day-active':''}" onclick="selDay('${dStr}')">${d}<div class="dot-row">${hasC?'<div class="dot dot-created"></div>':''}${hasD?'<div class="dot dot-due"></div>':'' }</div></div>`;
    }
    renderDayItems();
  }

  function selDay(d) { selD = d; buildCal(); }
  function changeMonth(v) { calD.setMonth(calD.getMonth()+v); buildCal(); }

  function jumpTo(id, isDone) {
    fE = ''; 
    setView(isDone ? 'completed' : 'lists', document.getElementById(isDone?'nav-completed':'nav-lists'));
    setTimeout(() => {
        const el = document.getElementById(`item-${id}`);
        if(el) { el.scrollIntoView({behavior:'smooth', block: 'center'}); el.classList.add('expanded'); el.style.boxShadow = '0 0 40px #fff'; setTimeout(() => el.style.boxShadow = 'none', 1200); }
    }, 250);
  }

  function renderDayItems() {
    const hits = vault.filter(i => i.created === selD || i.due === selD);
    document.getElementById('calDaySc').innerHTML = hits.map(i => `
      <div class="card" onclick="jumpTo(${i.id}, ${i.done})" style="border-left:4px solid var(--glow-${i.emoji}); cursor:pointer">
        <div class="card-ico" style="color:var(--glow-${i.emoji}); border-color:var(--glow-${i.emoji}); box-shadow: 0 0 10px var(--glow-${i.emoji})">${i.emoji}</div>
        <div style="font-size:9px; color:#666">${i.created === selD ? 'CREATED' : 'DUE'} TODAY</div>
        <div class="card-txt" style="margin-top:5px;">${i.text}</div>
      </div>`).join('');
  }

  function exportData(type) {
    const q = (type === 'lists' ? document.getElementById('qL').value : document.getElementById('qD').value).toLowerCase();
    const visible = vault.filter(i => (fE === '' || i.emoji === fE) && i.text.toLowerCase().includes(q) && i.done === (type === 'completed'));
    let content = `DCLIN VAULT EXPORT: ${type.toUpperCase()}\nFILTER: ${names[fE] || 'ALL'}\n\n`;
    visible.forEach(i => {
      content += `[${names[i.emoji]}] CREATED: ${i.created}\n${i.due ? `DUE: ${i.due}\n` : ''}CONTENT: ${i.text}\n--------------------------\n\n`;
    });
    const blob = new Blob([content], {type:'text/plain'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `DClin_Vault_Export.txt`; a.click();
  }
</script>
</body>
</html>
